<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login â€” Email or Username</title>
    <!-- Bootstrap 5 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f6f8fb;
      }
      .card {
        max-width: 420px;
        margin: 40px auto;
      }
      .segmented .btn {
        border-radius: 0.5rem;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <h4 class="card-title mb-1">Welcome back</h4>
          <p class="text-muted mb-3">Log in with your email or username</p>

          <!-- Toggle: Email or Username -->
          <div
            class="mb-3 segmented d-flex gap-2"
            role="tablist"
            aria-label="Login method"
          >
            <button
              id="btn-identifier-username"
              type="button"
              class="btn btn-outline-primary flex-fill active"
              data-method="username"
            >
              Username
            </button>
            <button
              id="btn-identifier-email"
              type="button"
              class="btn btn-outline-primary flex-fill"
              data-method="email"
            >
              Email
            </button>
          </div>

          <form id="loginForm" action="/login" method="POST" novalidate>
            <div class="mb-3">
              <label id="identifierLabel" for="identifier" class="form-label"
                >Username</label
              >
              <input
                type="text"
                class="form-control"
                id="identifier"
                name="identifier"
                placeholder="yourusername"
                required
                aria-describedby="identifierHelp"
              />
              <div id="identifierHelp" class="form-text">
                Use the option above to switch to email login.
              </div>
              <div class="invalid-feedback">
                Please enter a valid username or email.
              </div>
            </div>

            <div class="mb-3 position-relative">
              <label for="password" class="form-label">Password</label>
              <div class="input-group">
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  name="password"
                  placeholder="Password"
                  required
                  minlength="6"
                />
                <button
                  class="btn btn-outline-secondary"
                  type="button"
                  id="togglePassword"
                  aria-label="Show password"
                >
                  Show
                </button>
                <div class="invalid-feedback">
                  Please enter your password (min 6 characters).
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="remember"
                  name="remember"
                />
                <label class="form-check-label" for="remember"
                  >Remember me</label
                >
              </div>
              <a href="#" class="small">Forgot password?</a>
            </div>

            <div class="d-grid">
              <button id="submitBtn" class="btn btn-primary" type="submit">
                Log in
              </button>
            </div>
          </form>

          <hr class="my-3" />
          <p class="small text-center text-muted mb-0">
            Don't have an account? <a href="#">Sign up</a>
          </p>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      (function () {
        const btnUsername = document.getElementById("btn-identifier-username");
        const btnEmail = document.getElementById("btn-identifier-email");
        const identifier = document.getElementById("identifier");
        const identifierLabel = document.getElementById("identifierLabel");
        const identifierHelp = document.getElementById("identifierHelp");
        const loginForm = document.getElementById("loginForm");
        const togglePassword = document.getElementById("togglePassword");

        // Current method: 'username' or 'email'
        let method = "username";

        function setMethod(m) {
          method = m;
          if (m === "email") {
            btnEmail.classList.add("active");
            btnUsername.classList.remove("active");
            identifier.type = "email";
            identifier.placeholder = "you@example.com";
            identifierLabel.textContent = "Email address";
            identifierHelp.textContent = "We will never share your email.";
          } else {
            btnUsername.classList.add("active");
            btnEmail.classList.remove("active");
            identifier.type = "text";
            identifier.placeholder = "yourusername";
            identifierLabel.textContent = "Username";
            identifierHelp.textContent =
              "Use the option above to switch to email login.";
          }
          // reset validation state
          identifier.classList.remove("is-invalid");
          identifier.classList.remove("is-valid");
        }

        btnUsername.addEventListener("click", () => setMethod("username"));
        btnEmail.addEventListener("click", () => setMethod("email"));

        // Toggle password visibility
        togglePassword.addEventListener("click", () => {
          if (document.getElementById("password").type === "password") {
            document.getElementById("password").type = "text";
            togglePassword.textContent = "Hide";
          } else {
            document.getElementById("password").type = "password";
            togglePassword.textContent = "Show";
          }
        });

        // Form validation on submit
        loginForm.addEventListener("submit", function (e) {
          e.preventDefault();

          // Basic HTML5 validity first
          if (!loginForm.checkValidity()) {
            loginForm.classList.add("was-validated");
            return;
          }

          // Additional check: if email method, ensure valid email pattern
          if (method === "email") {
            const emailValue = identifier.value.trim();
            // simple email regex (not perfect but practical)
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailValue)) {
              identifier.classList.add("is-invalid");
              identifier.focus();
              return;
            }
          }

          // If all good, submit the form (you can change to fetch/ajax if desired)
          // For demo we'll just log values and show a success state
          const payload = {
            method,
            identifier: identifier.value.trim(),
            password: document.getElementById("password").value,
            remember: document.getElementById("remember").checked,
          };

          // Normally: loginForm.submit(); OR send fetch to server
          console.log("Submitting login", payload);
          // Simulate success feedback
          const submitBtn = document.getElementById("submitBtn");
          submitBtn.disabled = true;
          submitBtn.textContent = "Logging in...";

          // Simulated delay then redirect (for demo only)
          setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = "Log in";
            alert(
              "Demo: Credentials ready to be sent to server:\n" +
                JSON.stringify(payload, null, 2)
            );
            // window.location.href = '/dashboard';
          }, 800);
        });

        // initialize
        setMethod("username");
      })();
    </script>
  </body>
</html>
